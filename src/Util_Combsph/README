-----
// #################################################################
//
// Combine sph files and output
//
// Copyright (c) 2012-2013  All right reserved.
//
// Institute of Industrial Science, The University of Tokyo, Japan.
//
// #################################################################

Kenji Ono 	keno@riken.jp
AICS, RIKEN
October 2012
-----

このプログラムは，FFVで領域分割出力された計算結果ファイル（*.sph）に対して，次の二つの機能を提供します.
1) sphファイルを1つにまとめたファイルを作成します．
2) sphファイルからPLOT3Dデータファイルを作成します．



--- コンパイル方法

1) 単体でビルド
環境変数の設定はsrc/FFV/make_settingを編集します．
$ make


2) FFVディレクトリから一括ビルド
FFVディレクトリでffvcのコンパイルを行うと，combsphが生成されます．

../../binの下にcombsphという実行ファイルが生成されます．



--- 利用方法

$ combsph -f input_file

combsphを-hオプションをつけて実行すると，usageが表示されます．
実行後には，ログファイルとしてlog_comb.txtが出力されます．

Usage: combsph <option> filename

 Options:
  -d dirname   : Specify output directory name (default : ./ )
  -f filename  : Input file name
  -h           : Show usage
  -l log out   : print out logfile
  -s thin out  : thin out option
  -v verbose   : print more info


■ -d オプション

dirnameにはファイルを出力するディレクトリを指定します．
-fオプションで指定した入力ファイルにディレクトリの指定がある場合はそちらが優先されます．

■ -f オプション

filenameには用意した入力ファイルの名前を記述します。
入力ファイルは，FFVで利用するテキストパーサ形式で記述します．
CombDataタグの下に読み込むdfiファイルのリストを記述します．
出力フォーマットはout_formatで指定します．
plot3dを指定した場合は、PLOT3D_Optionsタグに必要な項目を記述する必要があります．

■ -s オプション

データを間引くためのオプションです。
sphファイルを1つにまとめる場合、PLOT3Dに変換する場合ともに有効です．
以下は -s 3 を指定した場合の間引きのイメージです．
元のデータ      ○○○○○○○○○○○○...
間引き後データ   ○●●○●●○●●○●●...

※ sphファイルがfloatで記述されているとき、PLOT3Dオプションでreal_type="double"を選択しても、出力はfloatに変更されます．
※ PLOT3D_Options/real_typeが指定されている場合、CombData/output_real_typeより優先されます．
※ 精度の指定がない場合は読み込みsphファイルの精度に従います．
※ 出力ディレクトリの指定がない場合はカレントディレクトリに出力します．



以下に入力ファイルの例を示します．

ファイル名：comb.tp
入力例：
 -----------

  CombData{

    //変換する出力ファイルの*.dfiファイルを記述
    list[@]="prs_.dfi" 
    list[@]="vel_.dfi"

    //ファイルフォーマットを指定
    out_format="sph"
    //out_format="plot3d"

    //出力時の単精度・倍精度を指定
    output_real_type="float"

    //入力データのディレクトリ指定
    input_dir="comb_in"

    //出力データのディレクトリ指定
    output_dir="comb_out"

  }

  // Plot3dの場合のオプションを記述
  PLOT3D_Options {
    filename        = "test"
    grid_kind       = "multi_grid"
    grid_mobility   = "immovable"
    state_of_time   = "unsteady"
    Dimension       = "3D"
    //Format_type     = "formatted"
    //Format_type     = "unformatted"
    Format_type     = "binary"
    divide_func     = "on" // divide_funcをonにすると項目ごとにファイルを分割して出力します
    real_type       = "float" // PLOT3D出力の単精度・倍精度を指定します
  }

 -----------



